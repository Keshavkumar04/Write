<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="app.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@1,300&family=Ubuntu:ital@1&display=swap" rel="stylesheet">
</head>
<body>
    <h1>How Discord Stores Trillions of Messages: A Technical Analysis</h1>
 <div class="container">
    <h2>Introduction: </h2>
    <p>Discord is a popular chat application used by millions of users worldwide. As the number of users grew to 140 million in 2021, Discord had to update its database infrastructure to manage the trillions of messages generated by its users. This article analyzes the technical details of how Discord migrated from MongoDB to Cassandra in 2017 and then to ScyllaDB in 2020.     
    </p>

    <h2>Challenges with MongoDB:</h2>
    <p>As Discord's popularity grew in 2017, the MongoDB database began causing significant scaling issues. Initially, Discord used 12 Cassandra nodes to store billions of messages. However, as the user base grew, the number of nodes increased to 177, and managing the system became a nightmare. The Discord engineering team faced significant slowdowns, and maintenance tasks such as compaction became too expensive.
     </p>

     <h2>Migration to Cassandra:</h2>
     <p>Discord switched to a Cassandra database in 2017 to manage its growing user base. Each message is partitioned by the channel and a time window called a bucket. Cassandra stores all messages for a given bucket together and replicates them across three nodes. However, this design caused major issues for small servers that sent few messages compared to giant servers like Mid Journey, where messages were sent every millisecond. Retrieving a message took more time than writing it, which caused latency across the entire database cluster. To optimize Cassandra's performance, Discord had to use compaction, but this maintenance task was expensive and often delayed, causing further issues.
     </p>

     <h2>Migration to ScyllaDB:</h2>
     <p>In 2020, Discord migrated from Cassandra to ScyllaDB, a high-performance NoSQL database written in C++. Our messaging system was using Cassandra as the underlying database to store messages. We had 12 nodes running Cassandra in 2017, and it was storing billions of messages. By the beginning of 2022, the number of nodes had increased to 177, and it was storing trillions of messages. Despite its name, the Cassandra-messages database became a high-maintenance system with unpredictable latency. Our on-call team was frequently paged to address issues, and we had to cut down on maintenance operations due to their high cost. ScyllaDB is designed to handle large amounts of data simultaneously and can scale up easily. One of the best features of ScyllaDB is the removal of the Java garbage collector, which was a constant issue with Cassandra. ScyllaDB is a great choice for organizations that need a high-performance, scalable database that can handle demanding workloads.
    </p>

    <h2>Conclusion:</h2>
    <p>Discord's migration to ScyllaDB has significantly improved its database infrastructure, enabling it to store trillions of messages while remaining operational without any downtime. The removal of the Java garbage collector and the ability to handle demanding workloads has made ScyllaDB an ideal choice for Discord's massive user base. While migrating to ScyllaDB was not a magical solution, it helped mitigate the issues with hot partitions, and we invested in improving our systems upstream of the database to facilitate better database performance.
    </p>
</div>
</body>
</html>